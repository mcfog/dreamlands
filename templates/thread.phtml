<?php
use Dreamlands\Entity\PostEntity;
use Dreamlands\Middleware\CurrentUserMiddleware;
use Dreamlands\Plate\DTemplate;

/**
 * @var DTemplate $this
 * @var CurrentUserMiddleware $currentUser
 * @var PostEntity $board
 * @var PostEntity $thread
 * @var PostEntity[] $posts
 * @var int $remain
 * @var int $from
 * @var string $next
 */
?>
<?php $this->layout('layout/default', get_defined_vars()) ?>
<div class="row">
    <h5 class="u-pull-left">
        <?= $this->e($thread->title ?: '无标题') ?>
    </h5>
    <span class="u-pull-right">
        <a href="/b/<?= $board->id ?>">
            返回<?= $this->e($board->title) ?>
        </a>
    </span>
</div>

<?php if ($currentUser->getUser()) {
    $this->insert('partial/postbox', [
        'parent' => $thread
    ]);
} ?>

<div class="thread">
    <div class="post">
        <?php $this->insert('partial/post', ['post' => $thread]) ?>
    </div>
</div>


<div class="post-list">
    <?php foreach ($posts as $post): ?>
        <div class="post">
            <?php $this->insert('partial/post', ['post' => $post]) ?>
        </div>
    <?php endforeach ?>
</div>

<div class="more">
    <hr>
    <?php if ($remain > 0): ?>
        <a href="/t/<?= $thread->id ?>?from=<?= $next ?>">更多</a>
    <?php endif ?>
    <?php if (!empty($last)): ?>
        <a href="/t/<?= $thread->id ?>?from=<?= $last ?>">最新</a>
    <?php endif ?>
    <?php if ($from > 0): ?>
        <a href="/t/<?= $thread->id ?>">返回</a>
    <?php endif ?>
    <span class="muted u-pull-right">剩余<strong><?= $remain ?></strong>条未显示</>
</div>

<style>
    .post .avatar.u_<?= $thread->user->name ?> {
        font-weight: bold;
    }
</style>
